#!/bin/sh

echo "[*] Scheduling a DAILY reboot at 08:00 UTC (3:00 AM EST)..."

REBOOT_FILE="/usr/lib/micron.d/reboot-nightly"

# Write the logger notice and reboot command
echo "44 17 * * * /usr/bin/logger 'AP will reboot in 1 minute (scheduled for 08:00 UTC / 3:00 AM EST)'" > "$REBOOT_FILE"
echo "45 17 * * * /sbin/reboot" >> "$REBOOT_FILE"

# Set proper permissions
chmod 644 "$REBOOT_FILE"

# Restart micrond to apply changes
echo "[*] Restarting micrond..."
killall micrond 2>/dev/null
sleep 1
/usr/sbin/micrond /usr/lib/micron.d &

# Confirm micrond is running
if ps | grep -q '[m]icrond'; then
    echo "[✓] micrond is running"
else
    echo "[✗] micrond is NOT running!"
    exit 1
fi

# Show current job contents
echo "[*] Current cron job file:"
cat "$REBOOT_FILE"
