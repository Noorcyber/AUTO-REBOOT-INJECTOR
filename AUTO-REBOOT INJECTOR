#!/bin/sh

cat <<'EOF'

  _____        _                    _    _____         _              _               
 |  __ \      | |                  | |  |_   _|       (_)            | |              
 | |__) | ___ | |__    ___    ___  | |_   | |   _ __   _   ___   ___ | |_  ___   _ __ 
 |  _  / / _ \| '_ \  / _ \  / _ \ | __|  | |  | '_ \ | | / _ \ / __|| __|/ _ \ | '__|
 | | \ \|  __/| |_) || (_) || (_) || |_  _| |_ | | | || ||  __/| (__ | |_| (_) || |   
 |_|  \_\\___||_.__/  \___/  \___/  \__||_____||_| |_|| | \___| \___| \__|\___/ |_|   
                                                     _/ |                             
                                                    |__/                              

By Noor Shaheed Kaseya, Datto  Vol1 2025

EOF

echo "[*] Scheduling NIGHTLY reboot for 3:00 AM EST (07:00 UTC)..."

# Create or update micrond job
cat <<EOF > /usr/lib/micron.d/reboot-nightly
59 6 * * * /usr/bin/logger 'AP will reboot at 3:00 AM EST (07:00 UTC) in 1 minute'
0 7 * * * /sbin/reboot
EOF

echo "[✓] Job written to /usr/lib/micron.d/reboot-nightly"

# Restart micrond to apply new job
echo "[*] Restarting micrond..."
killall micrond 2>/dev/null
/usr/sbin/micrond /usr/lib/micron.d &

# Confirm it's running
sleep 1
if ps | grep -q '[m]icrond'; then
  echo "[✓] micrond is running and will reboot AP daily at 07:00 UTC (3:00 AM EST)"
else
  echo "[✗] micrond failed to start!"
fi
