#!/bin/sh

echo "========================================"
echo "  üîÅ AUTO-REBOOT INJECTOR (TEST MODE)   "
echo "========================================"
echo "[*] Scheduling reboot for 4:40 PM today..."

CRON_DIR="/usr/lib/micron.d"
CRON_FILE="$CRON_DIR/reboot-nightly"

# Write the cron job
cat <<EOF > "$CRON_FILE"
39 16 * * * logger 'AP will reboot at 4:40 PM in 1 minute'
40 16 * * * /sbin/reboot
EOF

# Set proper permissions
chmod 644 "$CRON_FILE"

# Reload micrond
PID=$(pidof micrond)
if [ -n "$PID" ]; then
  kill -1 "$PID"
  echo "[‚úì] micrond reloaded (PID: $PID)"
else
  echo "[!] micrond not running ‚Äî starting it..."
  /usr/sbin/micrond "$CRON_DIR" &
fi

echo "[‚úì] Reboot scheduled at 4:40 PM."
echo "========================================"
